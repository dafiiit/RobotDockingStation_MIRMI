graph LR
    subgraph Docking_Station
        %% --- STATION NODES ---
        station_manager[station_manager_node]
        door_controller[door_controller_node]
        fluid_controller[fluid_controller_node]
        emitter_controller[emitter_controller_node]
    end
    subgraph Robot
        %% --- SENSOR DRIVER NODES ---
        subgraph Sensor_Drivers
            direction LR
            cam_node[camera_node]
            ir_cam_node[ir_camera_node]
            lidar_node[lidar_node]
            gps_node[gps_node]
        end

        %% --- PERCEPTION NODES ---
        subgraph Perception
            direction LR
            apriltag_node[apriltag_detector_node]
            depth_node[depth_estimation_node]
        end
        
        %% --- CONTROL & NAVIGATION NODES ---
        subgraph Control&Navigation
            direction LR
            docking_controller[docking_controller_node]
            nav2_stack[NAV2 Stack]
            robot_state_publisher[robot_state_publisher]
            pump_controller[robot_pump_controller]
        end

        %% --- ROBOT DATA FLOW ---
        cam_node -- /camera/image_raw --> apriltag_node
        cam_node -- /camera/image_raw --> depth_node

        apriltag_node -- /apriltag/detections --> docking_controller
        
        ir_cam_node -- /ir_camera/image_raw --> docking_controller
        lidar_node -- /scan --> nav2_stack
        gps_node -- /gps/fix --> nav2_stack

        depth_node -- /depth/point_cloud --> nav2_stack


        docking_controller -- /cmd_vel --> nav2_stack
        nav2_stack -- /cmd_vel --> RobotHardwareInterface:::tumBlue
        
        docking_controller -- /robot/pump_cmd --> pump_controller
        
    end

    %% === Cross-System Communication (via Tailscale VPN) ===
    docking_controller -.->|/dock_robot| station_manager
    station_manager -- /station/control_door (Service) --> door_controller
    station_manager -- /station/start_filling (Service) --> fluid_controller
    station_manager -- /station/set_emitters (Service) --> emitter_controller
    
    %% === Styles ===
    %% TUM Farben und modernes Design f√ºr alle Diagramme
    %% --- BASIS-STYLES ---
    classDef tumBlue fill:#0065BD,stroke:#003359,stroke-width:2px,color:#ffffff,rx:12,ry:12,font-size:14px,font-weight:bold;

    classDef tumLightBlue fill:#64A0C8,stroke:#003359,stroke-width:2px,color:#ffffff,rx:12,ry:12,font-size:14px,font-weight:bold;

    classDef tumOrange fill:#E87722,stroke:#B85A1A,stroke-width:2px,color:#ffffff,rx:12,ry:12,font-size:14px,font-weight:bold;

    classDef tumGreen fill:#A2AD00,stroke:#7A8500,stroke-width:2px,color:#ffffff,rx:12,ry:12,font-size:14px,font-weight:bold;

    %% --- SUBGRAPH-STYLES ---
    style Robot fill:#F8FBFF,stroke:#0065BD,stroke-width:3px,rx:20,ry:20,color:#000000,font-size:16px,font-weight:bold;

    style Docking_Station fill:#F2FAF9,stroke:#64A0C8,stroke-width:3px,rx:20,ry:20,color:#000000,font-size:16px,font-weight:bold;

    style Sensor_Drivers fill:#D3D3D3, color:#000000
    style Perception fill:#D3D3D3, color:#000000
    style Control&Navigation fill:#D3D3D3, color:#000000

    %% Alle Verbindungen einheitlich stylen
    linkStyle default stroke:#0065BD,stroke-width:2px;

